# 開発フェーズ定義（フェーズ論）

このファイルは、自動開発における各フェーズのひな型を定義したものである。
AIは各フェーズの「目的」「入力」「出力」「AIのアクション」を理解し、プロジェクトの状況に応じて具体化して適用すること。

---

## 【共通・最上流】フェーズ 1：要件定義（DDD主軸）

### 🎯 目的

プロジェクトの全容を把握し、DDD（ドメイン駆動設計）の概念を用いてビジネスロジックの核となる概念を整理する。

- **📥 入力**: ユーザー要望、既存ドキュメント
- **📤 出力**:
  - `docs/requirements_detail.md`: 詳細要件
  - `docs/ddd_core.md`: **DDDリスト**（エンティティ、値オブジェクト、ドメインサービス、コンテキスト境界の定義）
  - `docs/api_spec.json/yaml`: Swagger/OpenAPI仕様、型共有の定義
- **🛠 AIのアクション**:
  1. ユーザーの要望から「ドメイン（ビジネスの中核）」を抽出し、用語の定義（ユビキタス言語）と概念のリストを作成する。
  2. コンテキスト間の依存関係（コンテキストマップ等）を検討する。
  3. UI・DBの具体的な仕様を考える前に、ロジックとして成立するかを徹底的に確認する。

---

# 🚀 バックエンド（BE）フェーズ

## フェーズ 2-1：BE詳細設計

### 🎯 目的

DDDコアに基づき、バックエンドの具体的なデータ構造とロジックを確定させる。

- **📥 入力**: `docs/ddd_core.md`, `docs/api_spec.yaml`
- **📤 出力**:
  - `docs/be_design.md`:
    1. **DB設計**: テーブル定義、リレーション、インデックス
    2. **クラスリスト**: 各レイヤー（Domain, UseCase, Infrastructure等）の責務
    3. **関数リスト**: 各メソッドの振る舞い（自然言語で詳細化）
- **🛠 AIのアクション**:
  1. DDDリストを物理的なDBスキーマに落とし込む。
  2. 重複のない抽象化されたクラス・関数構成を設計し、ディレクトリ構造を確定させる。

## フェーズ 2-2：BE環境構築

### 🎯 目的

BE詳細設計に基づいたバックエンド開発基盤を整える。

- **📥 入力**: フェーズ2-1の構成案
- **📤 出力**: 設定ファイル、**OpenAPI 連携（型自動生成）設定**
- **🛠 AIのアクション**:
  1. `package.json`, Docker環境, テスト環境の構築。
  2. OpenAPIからの型生成（共有用）設定。

## フェーズ 2-3：BE実装（TDD x DDD）

### 🎯 目的

テストを主軸に、設計通りのバックエンドを構築する。

- **📥 入力**: `docs/be_design.md`（自然言語による詳細設計）
- **📤 出力**: `src/context/` 配下のドメイン・ユースケース層とテスト
- **🛠 AIのアクション**:
  1. **Red/Green/Refactor**: `be_design.md` に従い、勝手な追加をせず実装する。
  2. バグ発生時は実装を直し、テストコードは保護する。

## フェーズ 2-4：BE統合・完成（TDD）

### 🎯 目的

ドメインロジックをDB・外部APIと接続し、APIとして完結させる。ここでもTDDを継続し、外部依存は必要に応じてモックしてテストする。

- **📥 入力**: コアロジック、`docs/api_spec.yaml`
- ** AIのアクション**:
  1. **Integration TDD**: APIエンドポイントに対するテストを先に作成（モックDB/実DBの切り替えを考慮）。
  2. 実装を適用し、疎通とビジネスルールの整合性を確認。
  3. バックエンドを「完成」状態にする。

---

# 🎨 フロントエンド（FE）フェーズ

## フェーズ 3-1：FE詳細設計

### 🎯 目的

バックエンドAPIを基盤に、UIの構成とフロント専用のロジックを設計する。

- **📥 入力**: 完成したBE API、Swagger、UI要件
- **📤 出力**:
  - `docs/fe_design.md`:
    1. **Pages構成**: ルーティング
    2. **共通コンポーネントリスト**: UIパーツの定義
    3. **関数・カスタムフックリスト**: ロジックの共通化案
- **🛠 AIのアクション**:
  1. ページを跨ぐロジック（Hooks等）を抽出し、重複なきよう自然言語で定義する。

## フェーズ 3-2：FE環境構築

### 🎯 目的

フロントエンドの開発環境を整える。

- **📥 入力**: フェーズ3-1の構成案
- **📤 出力**: 設定ファイル、FEフレームワークの初期設定
- **🛠 AIのアクション**:
  1. FE用フレームワーク（Next.js等）の初期化、共有型のインポート。

## フェーズ 3-3：FE実装（TDD）

### 🎯 目的

詳細設計に従い、**TDD（テスト駆動開発）**を用いてUIとロジックを構築する。

- **� AIのアクション**:
  1. **Red/Green/Refactor (FE)**: Hooksやロジック、コンポーネントの振る舞いに対するテストを先に作成する。
  2. **Mocking**: バックエンドへの接続は、フェーズ1で定義した型に基づきMSW（Mock Service Worker）等でモックしてテスト駆動する。
  3. テストが通った後、実APIとの結合を確認する。

---

## 【最終検証】フェーズ 4：QA・品質保証

### 🎯 目的

全体が正しく動作することを保証する。

- **📥 入力**: 完成したアプリケーション全体（Frontend + Backend）
- **📤 出力**:
  - `tests/e2e/`（E2Eテストコード/Playwright等）
  - `docs/testing_report.md`（検証記録）
- **🛠 AIのアクション**:
  1. Playwright等で自動テストを行い、デプロイ準備を整える。
  2. デプロイ作業を行い、全工程の完了報告を行う。
