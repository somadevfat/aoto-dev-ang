## 5. ワークフロー (Workflows) の構築

ワークフローは **複数ステップからなる一連の作業手順** を定義します。
`<root>/.agent/workflows/` に配置します。

### 5.1 `/full-auto-dev` - 完全自動開発ワークフロー（メイン）

```markdown
---
description: 要件定義書から完全自動でアプリを開発するメインワークフロー
---

# 完全自動開発ワークフロー

## 前提

- 要件定義書（Markdown）が提供されている
- 全てを **自然言語で設計してからコードに起こす**
- `parts/*` ブランチでクラス・関数・コンポーネント単位に TDD → `dev` にマージ
- `build` ブランチでパーツを組み立て → `dev` にマージして機能完成
- **スコープ**: `dev` ブランチ上での開発完了まで。`qa` 以降は手動

## 手順

### Phase 1: 要件分析 & DDDリスト作成

// turbo

1. `requirements-analysis` スキルを適用して要件を分析する
2. DDDリスト（Context・エンティティ・VO・サービス）を作成する
3. 分析結果をレビュー用アーティファクトとして出力する

### Phase 2: 自然言語で全体設計

// turbo

4. `clean-architecture` スキルを適用してディレクトリ構造を生成する
5. 分析結果にドメインありと判断された場合、`ddd-modeling` スキルを適用する
6. DDDリストから **関数単位** にリストアップする
7. **共通化できる関数** を自然言語の時点で特定・統合する
8. フロントエンドの **コンポーネントリスト** を作成する（共通→ページ固有の順）

### Phase 3: 実装タスクリスト & parts 計画

// turbo

9. 自然言語設計をもとに実装タスクリストを作成する
10. `parts/*` ブランチ名を決定する（クラス/関数/コンポーネント単位）

★ この時点で実行プランをアーティファクトとして表示 → 確認

### Phase 4: パーツ実装（TDD）→ dev マージ

// turbo

以下のサイクルを繰り返す:

11. `dev` から `parts/[パーツ名]` ブランチを作成する
12. `tdd-implementation` スキルで個別に TDD 実装する
13. 全テスト通過を確認して `dev` にマージする
14. 独立した parts は並列で実装を進める

### Phase 5: 組立（build）→ dev マージ

// turbo

15. `dev` から `build` ブランチを作成する
16. `dev` に集まったパーツを組み立てて機能として動くようにする
17. 結合部分のテストを書いて通す
18. `dev` にマージして機能完成

### Phase 6: Phase 4-5 を繰り返し

// turbo

19. 全機能が `dev` 上で完成するまで Phase 4-5 を繰り返す
20. lint / 型チェック / セキュリティチェックを実施する
21. ウォークスルーで最終結果を報告する

※ `qa`・`main`（テスト・デプロイ）は手動で実施する（スコープ外）
```

### 5.2 `/tdd-cycle` - TDDサイクル

```markdown
---
description: 単一の関数/クラスに対するTDDサイクルを実行する
---

# TDD サイクル

// turbo-all

1. 対象の関数/クラスのインターフェースを定義する
2. テストファイルを作成し、失敗するテストを書く
3. `bun test` でテストが失敗することを確認する
4. テストを通す最小限の実装コードを書く
5. `bun test` でテストが成功することを確認する
6. コードをリファクタリングする
7. `bun test` でテストが引き続き成功することを確認する
```

### 5.3 `/e2e-verify` - E2E検証

```markdown
---
description: E2Eテストを実行し結果を報告する
---

# E2E 検証

// turbo-all

1. `bunx playwright install` でブラウザをインストールする
2. アプリケーションを開発サーバーで起動する
3. `bunx playwright test` でE2Eテストを実行する
4. 失敗したテストがある場合、ブラウザサブエージェントで画面を確認する
5. 失敗原因を特定し修正する
6. 全テストがパスするまで繰り返す
7. テスト結果のスクリーンショットを保存する
```
